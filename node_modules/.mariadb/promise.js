'use strict';

const pkg = require('.mariadb/package.json')
require('.mariadb/node_modules/please-upgrade-node')(pkg)

const Connection = require('.mariadb/lib/connection');
const PoolPromise = require('.mariadb/lib/pool-promise');
const PoolCluster = require('.mariadb/lib/pool-cluster');

const ConnOptions = require('.mariadb/lib/config/connection-options');
const PoolOptions = require('.mariadb/lib/config/pool-options');
const PoolClusterOptions = require('.mariadb/lib/config/pool-cluster-options');

module.exports.version = require('.mariadb/package.json').version;
module.exports.SqlError = require('.mariadb/lib/misc/errors').SqlError;

module.exports.createConnection = function createConnection(opts) {
  try {
    const options = new ConnOptions(opts);
    return new Connection(options).connect();
  } catch (err) {
    return Promise.reject(err);
  }
};

module.exports.createPool = function createPool(opts) {
  const options = new PoolOptions(opts);
  const pool = new PoolPromise(options, false);
  pool.initialize();
  return pool;
};

module.exports.createPoolCluster = function createPoolCluster(opts) {
  const options = new PoolClusterOptions(opts);
  return new PoolCluster(options);
};
